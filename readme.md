### 1. 目录结构

```
└─主文件夹
	├─mlp.py（主程序）
	├─solver.py（定义了正向和反向传播规则，权重更新规则）
	├─model.py（模型定义）
	├─config.py（定义了图片，数据集保存位置）
	├─layer_utils.py（relu, sigmoid, 线性函数的前向和反向传播）
	├─*.pkl（训练后的模型保存文件）
	├─images文件夹（初次运行时会自动创建）
		├─accuracy.png（训练时的正确率曲线，包括在训练集和测试集上的正确率，横轴为epoch数目）
		├─intensity_数字.png（保存在不同噪声强度下的图像识别（25个数字的识别结果），例如intensity_10.png为在噪声强度为10（高斯分布标准差为10，均值为0）时的识别结果）
		├─loss.png（训练时cost function的变化，横轴为迭代次数）
		├─Mini_set_intensity_数字.png（随机预测25个手写数字的结果（只预测25个），而intensity_数字.png会在整个测试集上跑一遍（慢很多））
		└─Test_Acc数字1-数字2.png（在噪声强度[数字1，数字2]范围内预测正确率的曲线）
	└─dataset文件夹（初次运行时会自动创建）
		└─MNIST数据集（初次运行会自动下载）
```

### 2. 程序使用

#### 2.1 查看帮助

```shell
python .\mlp.py -h #输出程序的命令行参数和调用方法
```

有多个命令行参数，下面用到再返回来看，表中的短参数和长参数是等价的，比如`-f`和`--file`是等价的，只是短参数方便，长参数可读性好

| 段参数           | 长参数               | 含义                                                         |
| ---------------- | -------------------- | ------------------------------------------------------------ |
| `-f 文件名`      | --file 文件名        | 读取文件中的模型（模型保存的时候都是以.pkl结尾的），从头训练时可以不指定文件，其他情况都要指定 |
| `-t`             | --train              | 训练模型（会输出*.pkl模型文件，loss.png，accuracy.png）      |
| `-b`             | --batch_size         | 训练参数，每次训练迭代时使用的样本数（可以不指定，默认为100） |
| `-e 数字`        | --epochs 数字        | 训练参数，模型需要训练的epoch数（必须指定）                  |
| `-l 数字`        | --learning_rate 数字 | 训练参数，模型训练时的学习率（可以不指定，默认为0.5）        |
| `-v 数字`        | --verbose 数字       | 训练参数，模型训练迭代多少次打印一次信息，数字为0时不打印（可以不指定，默认为100） |
| `-d 文件名`      | --dump 文件名        | 训练参数，模型训练结束以后保存的文件名（之后可以通过-f重新读取），保存时会在输入的文件名后加.pkl后缀（可以不指定，默认为MNIST-MLP-时间戳） |
| `-p`             | -predict             | 使用模型预测数据                                             |
| `-m` 数字        | -mean 数字           | 高斯噪声的均值                                               |
| `-n 数字1 数字2` | -noise 数字1 数字2   | 在整个测试数据集上（10000个图片上）在噪声强度[数字1， 数字2]区间内（步长为1）预测数字，并给每个噪声强度输出一个intensity_数字.png预测的图片（所有图片中的25个数字都是一样的，但是是随机的），同时输出Test_Acc数字1-数字2.png。例如`-n 0 2`会输出intensity_0.png,intensity_1.png，intensity_2.png，Test_Acc0-4.png |
| -s 数字          | -single 数字         | 仅在测试数据集上使用随机25个图片在指定的噪声强度下进行预测并输出Mini_set_intensity_数字.png |



#### 2.2 模型训练

模型训练主要分为两种：

1. 从头开始训练新的模型

2. 继续训练已有的模型

**2.2.1 从头开始训练**

默认参数下使用`-e 30`即可达到训练数据集上100%正确率和测试数据集>98.5%的效果

```shell
# 可以指定所有参数
python ./mlp.py -t -e 30 -l 0.8 -v 120 -d first_model
模型最终会保存为first_model.pkl，并输出上述的图片
# 使用默认的参数进行训练，但是必须指定-e参数
python ./mlp.py -t -e 30	#模型保存为以MNIST-MLP为前缀的文件
```

**2.2.2 继续训练已有的模型**

```shell
# 可以指定所有参数
python ./mlp.py -t -f fiest_model.pkl -e 30 -l 0.8 -v 120 -d second_model
#模型最终会保存为second_model.pkl，并输出上述的图片
# 使用默认的参数进行训练，但是必须指定-e参数
python ./mlp.py -t -f fiest_model.pkl -e 30	#模型保存为以MNIST-MLP为前缀的文件
```



#### 2.3 预测数据

预测数据主要纷纷为`-n`和`-s`两种

```shell
python ./mlp.py -p -f first_model.pkl -n 0 10	# 在整个测试数据集上在指定的噪声强度区间预测
p./mlp.py -p -f first_model.pkl -s 10	# 随机选取25张图片，在噪声强度为10的情况下预测
```







